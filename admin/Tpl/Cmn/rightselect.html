<!--筛选部分-->
<script>
  var dosearch='__URL__/dosearch';
  var obj = new Object()
</script>

<div class='col-md-12' style='margin-top: 20px'>
  <div class="panel-group" id="accordion1" role="tablist" aria-multiselectable="true">
    <div class="panel panel-default">
      <div class="panel-heading" role="tab" id="headingOne">
        <h4 class="panel-title">
          <a class='collapsed' data-toggle="collapse" data-parent="#accordion1" href="#collapseOne1" aria-expanded="false" aria-controls="collapseOne1">
            字段-条件-排序 筛选
          </a>
        </h4>
      </div>
      <div id="collapseOne1" class="panel-collapse collapsing" role="tabpanel" aria-expanded="false" aria-labelledby="headingOne1">
        <div class="panel-body">
          <!---->
          <div role="tabpanel">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
              <li role="presentation" class="active"><a href="#cdt" aria-controls="cdt" role="tab" data-toggle="tab">条件</a></li>
              <li role="presentation"><a href="#spccdt" aria-controls="spccdt" role="tab" data-toggle="tab">特殊条件</a></li>
              <li role="presentation"><a href="#fld" aria-controls="fld" role="tab" data-toggle="tab">字段</a></li>
              <li role="presentation"><a href="#odr" aria-controls="odr" role="tab" data-toggle="tab">顺序</a></li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content" style="padding-top: 10px">
              <div role="tabpanel" class="tab-pane active" id="cdt">
              <?php foreach ($para as $key => $value) {
                if(!in_array($key,$hide_cdt)){
              ?>
              <div class='col-md-3'>
              {$value} 
              <?php if(strstr($key,'_id')){ ?>
              <select class='cdt' id='{$key}_cdt'>
                <option value="">无</option>
                <?php foreach ($key as $k => $v) { ?><option value='{$k}'>{$v}</option><?php } ?>
              </select>
              <?php }else{ ?><input class='cdt' id='{$key}_nb_cdt'><?php } ?>
              </div>
              <?php
                }
              } ?>  
              </div>

              <div role="tabpanel" class="tab-pane" id="spccdt">
              <volist name='spccdt' id='spccdtv'>
                <div class='col-md-4'>
                <button class='spccdt btn <?php if($spccdtv[2]==1){ ?> btn-info <?php }else{ ?>btn-default<?php } ?>' value='{$spccdtv[0]}'>{$spccdtv[1]}</button>
                </div>
              </volist>
              </div>

              <div role="tabpanel" class="tab-pane" id="fld">
              <?php foreach ($para as $key => $value) {
                if(!in_array($key,$hide_fld)){
              ?>
              <div class='col-md-2'><input class='fld' type="checkbox" id='{$key}_nb_fld' <?php if(in_array($key,$fld)){ ?>checked<?php } ?> > {$value}</div>
              <?php 
                }else{
              ?>
              <script>obj['{$key}'+'_nb_fld']='{$key}';</script>
              <?php 
                }
              }
              ?>

              </div>

              <div role="tabpanel" class="tab-pane" id="odr">
                <volist name='odr' id='odrv'>
                  <div class='col-md-4'>
                  {$para[$odrv[0]]} <select class='odr' id='{$odrv[0]}_nb_odr'><option value="">无</option><option value="ASC">升序</option><option value="DESC">降序</option></select><script>$('#{$odrv[0]}_odr').val('{$odrv[1]}');</script>
                  </div>
                </volist>
              </div>
            </div>

          </div>
         <!---->
         <div class='clearfix'></div><hr>
         <div class='col-md-1'>每页<select id='_nb_lmt' style='width: 30px'><option value='10'>10</option><option value='20'>20</option><option value='50'>50</option><option value='100'>100</option></select></div><div class='col-md-1'><button class='btn btn-primary' id='search'>查询</button></div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<script>
  $(function(){
    $('#search').click(function(){
      
      //处理cdt
      var cdtls=$('.cdt');
      for(var i=0;i<cdtls.size();i++){
        cdto=cdtls[i];var id_cdt=$(cdto).attr('id');
        if($.trim($(cdto).val())!=''){
          obj[id_cdt]=$.trim($(cdto).val());
        }
      }
      //处理spccdt
      var spccdtls=$('.spccdt');
      for(var i=0;i<spccdtls.size();i++){
        spccdto=spccdtls[i];
        var cls=$(spccdto).attr('class');
        if(cls.indexOf('info')!=-1){
          obj[i+'_nb_spccdt']=$(spccdto).val();
        }
      }
      //处理fld
      var fldls=$('.fld');
      for(var i=0;i<fldls.size();i++){
        fldo=fldls[i];
        if($(fldo).is(':checked')==true){
          var id_fld=$(fldo).attr('id');
          obj[id_fld]='checked';
        }
      }
      //处理odr
      var odrls=$('.odr');
      for(var i=0;i<odrls.size();i++){
        odro=odrls[i];var id_odr=$(odro).attr['id'];
        if($(odro).val()!=''){
          obj[id_odr]=$(odro).val();
        }
      }
      //处理lmt

      $.ajax({
          'type': 'GET',
          'url':dosearch,
          'async':false,  
          'contentType': 'application/json',
          'data': obj,
          'dataType': 'json',
          'success': function(data) {
            if(data['rslt']==1){
              //window.location.reload();
            }else{
              alert(data['msg']);
            }
           
              console.log("success");
          },
          'error':function() {
              console.log("error");
          }
      });
    })

    
  })
</script>